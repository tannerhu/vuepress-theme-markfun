---
title: 4B Docker安装
date: 2021-07-11 21:19:58
permalink: /pages/ab39c1/
categories:
  - 《微机》
  - Raspberry Pi
tags:
  - 
---
### 安装方法一（脚本安装）
#### 1. Docker 安装

`curl -sSL https://get.docker.com| sh`
默认情况下执行docker命令是需要root权限的，也就是要用sudo docker 来运行。

以下方法可以免去sudo执行，重启生效：  
`sudo usermod -aG docker pi && sudo reboot`

### 安装方法二（apt 安装 未测试仅供参考）
由于 Raspbian 基于 Debian，我们还可以使用 apt 来安装 Docker，首先需要更新一下软件包的索引。  
`sudo apt-get update`  
安装 HTTPS 所依赖的包  
`sudo apt-get install apt-transport-https ca-certificates software-properties-common`  

添加 Docker 的 GPG key  
`curl -fsSL https://yum.dockerproject.org/gpg | sudo apt-key add -`  
验证 key id:  
`apt-key fingerprint 58118E89F3A912897C070ADBF76221572C52609D`  

设置稳定的 repository:  
`sudo add-apt-repository "deb https://apt.dockerproject.org/repo/ raspbian-$(lsb_release -cs) main"`   
注意：如果 add-apt-repository 命令遇到问题，可以尝试将下面这行添加到树莓派软件源 sources.list，操作如下：  
`sudo nano /etc/apt/sources.list`  
添加一行：  
`deb https://apt.dockerproject.org/repo/ raspbian-RELEASE main`  
根据自己系统版本调整上面的 RELEASE。通过下面的命令可以查看发行版。    
`lsb_release -cs`  
安装 Docker  
`sudo apt-get updatesudo apt-get -y install docker-engine`  
测试 Docker  
运行 hello-world 镜像来做一个测试。  
`sudo docker run hello-world`  
如果 Docker 安装成功，你会看到一条消息：“Hello from Docker!”。  


### docker-compose 安装

#### Docker Compose的安装方法有很多，下面这个用pip安装的树莓派方法亲测可用

`sudo apt-get update`  
`sudo apt-get install -y python python-pip`  

需注意默认python需要3.5以上 python 命令不是3.5以上的需切换默认版本  
`sudo pip install docker-compose`  

#### 树莓派切换默认python版本
`cd /usr/bin/ && sudo rm -rf ./python`  
`sudo ln -s /usr/bin/python3 /usr/bin/python`

### 常用docker配置和工具命令

```bash
#查看 Docker 版本
docker -v
sudo docker pull 仓库/镜像:版本（留空的话默认为 latest）
sudo docker run 加参数，用来创建容器
#查看运行容器
sudo docker ps
#查看所有下载的镜像
sudo docker images
#进入容器终端
sudo docker exec -i -t ha /bin/bash
#实时查看10行的 ha 日志
sudo docker logs -f -t --tail 10 ha
#重启 systemctl 守护进程
sudo systemctl daemon-reload
#设置 Docker 开机启动
sudo systemctl enable docker
#开启 Docker 服务
sudo systemctl start docker
 
#下载 Docker 图形化界面 portainer
sudo docker pull portainer/portainer
#创建 portainer 容器
sudo docker volume create portainer_data
#运行 portainer
sudo docker run -d -p 9000:9000 --name portainer --restart always -v /var/run/docker.sock:/var/run/docker.sock -v portainer_data:/data portainer/portainer
```
用docker-compose启动portainer  

docker-compose.yml
```
version: '2'

services:
  portainer-web:
    image: portainer/portainer
    container_name: portainer-web
    restart: always
    privileged: true
    ports:
      - "9000:9000"
    volumes:
      - ./portainer-data:/data
      - /var/run/docker.sock:/var/run/docker.sock
```
在yml目录下执行命令启动容器  
`docker-compose up -d`

运行之后在浏览器中输入树莓派IP:9000 进入界面，首次访问需要设定登录密码，并选择Local进行管理本地容器