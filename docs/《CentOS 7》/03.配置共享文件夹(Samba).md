---
title: 配置共享文件夹(Samba)
date: 2021-05-31 14:12:06
permalink: /pages/565097/
categories:
  - 《CentOS 7》
tags:
  - CentOS
---

## CentOS7配置共享文件夹

1、打开CentOS7的终端Konsole，使用“rpm -qi samba"命令查询是否已经安装了Samba，然后使用“yum install samba”命令，下载Samba包并安装。输入“y”，确认安装软件和软件依赖包。

2、使用`rpm -qa | grep samba`查看已经安装好的Samba的信息

3、添加共享文件夹的用户，使用`smbpasswd -a username`。

smbpasswd命令的常用方法`smbpasswd -a` 增加用户（要增加的用户必须是系统用户）`smbpasswd -d` 冻结用户，就是这个用户不能在登录了`smbpasswd -e` 恢复用户，解冻用户，让冻结的用户可以在使用`smbpasswd -n` 把用户的密码设置成空. 要在global中写入 null passwords -truesmbpasswd -x 删除用户

#### 无权限访问的话 可能SELinux没关 修改/etc/sysconfig/selinux 把enforcing改成disabled；然后命令行setenforce 0；

4、使用命令`mkdir /home/noiccy/myshare`，在用户noiccy文件夹下新建“myshare”共享文件夹。

5、使用命令`chmod -R 777 /home/willy/myshare`,将整个myshare文件夹与其中的文件和子目录的权限都设置为rwxrwxrwx，即所有人都可以查看操作。777: 0表示没有权限，1表示可执行权限，2表示可写权限，4表示可读权限，然后将其相加。所以数字属性的格式应为3个从0到7的八进制数，其顺序是（u）（g）（o）。 例如，如果想让某个文件的属主有“读/写”二种权限，需要把4（可读）+2（可写）＝6（读/写）。

6、使用命令`cd /etc/samba`进入Samba配置文件目录，并使用“ls”列出该目录下所有的文件，其中“smb.conf.bak”，是使用命令“cp smb.conf smb.conf.bak"对Samba配置文件做的一个备份

7、使用命令`vi smb.conf`，进入Samba配置文件，按下“i”键修改配置文件。

```
[global]
    workgroup = WORKGROUP
    server string = Tanner Samba Server %v
    netbios name = TANNER-SAMBA
    security = user
    

    log file = /var/log/samba/log.%m
    max log size = 10240
    passdb backend = tdbsam
    
    printing = cups
    printcap name = cups
    load printers = yes
    cups options = raw
    
    browseable = yes

[homes]
    comment = Home Directories
    valid users = %S, %D%w%S
    browseable = No
    read only = No
    inherit acls = Yes
    writable = yes
[printers]
    comment = All Printers
    path = /var/tmp
    printable = Yes
    create mask = 0600
    browseable = No

[print$]
    comment = Printer Drivers
    path = /var/lib/samba/drivers
    write list = @printadmin root
    force group = @printadmin
    create mask = 0664
    directory mask = 0775

[share]
    comment = Public Share dev
    path = /home/share
    public = no
    writable = yes
    printable = no
    browseable = yes
    

    valid users = tannerhu
    write list = tannerhu

```

8、按下“Esc”键，并输入“：wq！”，退出配置文件，使用命令“systemctl stop firewalld”关闭防火墙，然后使用命令“systemctl disable firewalld”禁止防火墙开机启动

9、启动Samba服务，

输入命令`systemctl start smb`   
输入命令`systemctl start nmb`  

10、查看IP地址：`ifconfig`

`vi  /etc/sysconfig/iptables`

```shell
#开放共享nmb137端口 开放共享nmb138端口
-A INPUT -p udp -m multiport --dports 137,138 -j ACCEPT
-A OUTPUT -p udp -m multiport --sports 137,138 -j ACCEPT
#开放共享smb139端口
-A INPUT -p tcp -m state --state NEW -m tcp --dport 139 -j ACCEPT
#开放共享445端口
-A INPUT -p tcp -m state --state NEW -m tcp --dport 445 -j ACCEPT
```

11、启动Samba服务后，在Windows系统上按下“win+r”键，输入"\\共享文件夹的IP地址"，在看到文件夹后，点击进入文件夹，输入账户名和密码即可查看共享文件。  

开机启动  
`systemctl enable smb`
`systemctl enable nmb`    
查看设置成功    
`systemctl list-unit-files |   grep enable` 